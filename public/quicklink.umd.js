!function(e,n){"object"==typeof exports&&"undefined"!=typeof module?n(exports):"function"==typeof define&&define.amd?define(["exports"],n):n((e||self).quicklink={})}(this,function(e){function n(e,n){(null==n||n>e.length)&&(n=e.length);for(var r=0,t=new Array(n);r<n;r++)t[r]=e[r];return t}function r(e){return new Promise(function(n,r,t){(t=new XMLHttpRequest).open("GET",e,t.withCredentials=!0),t.onload=function(){200===t.status?n():r()},t.send()})}function t(e){return window.fetch?fetch(e,{credentials:"include"}):r(e)}var o,i=(o=document.createElement("link")).relList&&o.relList.supports&&o.relList.supports("prefetch")?function(e){return new Promise(function(n,r,t){(t=document.createElement("link")).rel="prefetch",t.href=e,t.onload=n,t.onerror=r,document.head.appendChild(t)})}:r,c=window.requestIdleCallback||function(e){var n=Date.now();return setTimeout(function(){e({didTimeout:!1,timeRemaining:function(){return Math.max(0,50-(Date.now()-n))}})},1)},a=new Set,u=new Set,s=!1;function f(e,n){return Array.isArray(n)?n.some(function(n){return f(e,n)}):(n.test||n).call(n,e.href,e)}function l(e){if(e){if(e.saveData)return new Error("Save-Data is enabled");if(/2g/.test(e.effectiveType))return new Error("network conditions are poor")}return!0}function d(e,n){var r=l(navigator.connection);return r instanceof Error?Promise.reject(new Error("Cannot prefetch, "+r.message)):(u.size>0&&!s&&console.warn("[Warning] You are using both prefetching and prerendering on the same document"),Promise.all([].concat(e).map(function(e){return a.has(e)?[]:(a.add(e),(n?t:i)(new URL(e,location.href).toString()))})))}function h(e){var r=l(navigator.connection);if(r instanceof Error)return Promise.reject(new Error("Cannot prerender, "+r.message));if(!HTMLScriptElement.supports("speculationrules"))return d(e),Promise.reject(new Error("This browser does not support the speculation rules API. Falling back to prefetch."));for(var t,o=function(e,r){var t="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(t)return(t=t.call(e)).next.bind(t);if(Array.isArray(e)||(t=function(e,r){if(e){if("string"==typeof e)return n(e,r);var t=Object.prototype.toString.call(e).slice(8,-1);return"Object"===t&&e.constructor&&(t=e.constructor.name),"Map"===t||"Set"===t?Array.from(e):"Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?n(e,r):void 0}}(e))){t&&(e=t);var o=0;return function(){return o>=e.length?{done:!0}:{done:!1,value:e[o++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}([].concat(e));!(t=o()).done;)u.add(t.value);a.size>0&&!s&&console.warn("[Warning] You are using both prefetching and prerendering on the same document");var i=function(e){var n=document.createElement("script");n.type="speculationrules",n.text='{"prerender":[{"source": "list","urls": ["'+Array.from(e).join('","')+'"]}]}';try{document.head.appendChild(n)}catch(e){return e}return!0}(u);return!0===i?Promise.resolve():Promise.reject(i)}e.listen=function(e){if(void 0===e&&(e={}),window.IntersectionObserver&&"isIntersecting"in IntersectionObserverEntry.prototype){var n=function(e){e=e||1;var n=[],r=0;function t(){r<e&&n.length>0&&(n.shift()(),r++)}return[function(e){n.push(e)>1||t()},function(){r--,t()}]}(e.throttle||1/0),r=n[0],t=n[1],o=e.limit||1/0,i=e.origins||[location.hostname],l=e.ignores||[],p=e.delay||0,m=[],g=e.timeoutFn||c,v="function"==typeof e.hrefFn&&e.hrefFn,w=e.prerender||!1;s=e.prerenderAndPrefetch||!1;var y=new IntersectionObserver(function(n){n.forEach(function(n){if(n.isIntersecting)m.push((n=n.target).href),function(e,n){n?setTimeout(e,n):e()}(function(){m.includes(n.href)&&(y.unobserve(n),(s||w)&&u.size<o?h(v?v(n):n.href).catch(function(n){if(!e.onError)throw n;e.onError(n)}):a.size<o&&!w&&r(function(){d(v?v(n):n.href,e.priority).then(t).catch(function(n){t(),e.onError&&e.onError(n)})}))},p);else{var i=m.indexOf((n=n.target).href);i>-1&&m.splice(i)}})},{threshold:e.threshold||0});return g(function(){(e.el&&e.el.length&&e.el.length>0&&"A"===e.el[0].nodeName?e.el:(e.el||document).querySelectorAll("a")).forEach(function(e){i.length&&!i.includes(e.hostname)||f(e,l)||y.observe(e)})},{timeout:e.timeout||2e3}),function(){a.clear(),y.disconnect()}}},e.prefetch=d,e.prerender=h});
